/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  MxmindIframeView: () => MxmindIframeView,
  VIEW_TYPE_EXAMPLE: () => VIEW_TYPE_EXAMPLE,
  default: () => MxmindPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var iframe = null;
var ready = false;
var VIEW_TYPE_EXAMPLE = "mxmind-view";
function getTheme() {
  return document.body.hasClass("theme-dark") ? "dark" : "light";
}
function getLanguage() {
  const locale = import_obsidian.moment.locale();
  const arr = locale.split("-");
  if (arr[1]) {
    arr[1] = arr[1].toString().toUpperCase();
  }
  return arr.join("-");
}
var getUrl = () => {
  return "https://mxmind.com/mindmap/new?utm_source=obsidian&theme=" + getTheme() + "&lng=" + getLanguage();
};
var MxmindPlugin = class extends import_obsidian.Plugin {
  //settings: MyPluginSettings;
  async onload() {
    this.registerView(
      VIEW_TYPE_EXAMPLE,
      (leaf) => new MxmindIframeView(leaf)
    );
    const ribbonIconEl = this.addRibbonIcon(
      "network",
      "Mxmind",
      (evt) => {
        this.toggleView();
      }
    );
    this.registerEvent(
      this.app.workspace.on("file-menu", (menu, file) => {
        const extension = file.extension;
        if (!extension || extension != "md")
          return;
        if (!(file instanceof import_obsidian.TFile))
          return;
        menu.addItem((item) => {
          item.setTitle("Open as mindmap").setIcon("document").onClick(async () => {
            const content = await this.app.vault.cachedRead(
              file
            );
            const post = async () => {
              postIframeMessage("loadFromMd", [content]);
            };
            await this.activateView();
            waitEditor().then(post).catch(post);
          });
        });
      })
    );
    this.registerEvent(
      this.app.workspace.on("css-change", () => {
        postIframeMessage("setTheme", [getTheme()]);
      })
    );
  }
  onunload() {
  }
  // async loadSettings() {
  // 	this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  // }
  // async saveSettings() {
  // 	await this.saveData(this.settings);
  // }
  async toggleView() {
    var _a;
    const { workspace } = this.app;
    this.toggleCollapseRight();
    let leaf = null;
    const leaves = workspace.getLeavesOfType(VIEW_TYPE_EXAMPLE);
    if (leaves.length > 0) {
      leaf = leaves[0];
      workspace.setActiveLeaf(leaf);
    } else {
      leaf = workspace.getRightLeaf(false);
      await leaf.setViewState({ type: VIEW_TYPE_EXAMPLE, active: true });
    }
    (_a = iframe == null ? void 0 : iframe.contentWindow) == null ? void 0 : _a.postMessage(
      {
        method: "fullScreen",
        params: []
      },
      "*"
    );
  }
  async activateView() {
    const { workspace } = this.app;
    let leaf = null;
    const leaves = workspace.getLeavesOfType(VIEW_TYPE_EXAMPLE);
    if (leaves.length > 0) {
      leaf = leaves[0];
    } else {
      leaf = workspace.getRightLeaf(false);
    }
    await leaf.setViewState({ type: VIEW_TYPE_EXAMPLE, active: true });
    workspace.revealLeaf(leaf);
    return leaf;
  }
  toggleCollapseRight() {
    const rightSplit = this.app.workspace.rightSplit;
    rightSplit.collapsed ? rightSplit.expand() : rightSplit.collapse();
  }
};
var MxmindIframeView = class extends import_obsidian.ItemView {
  constructor(leaf) {
    super(leaf);
    this.navigation = true;
  }
  getViewType() {
    return VIEW_TYPE_EXAMPLE;
  }
  getDisplayText() {
    return "Mxmind";
  }
  getIcon() {
    return "network";
  }
  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    const int = setInterval(() => {
      if (this.leaf.tabHeaderEl && this.leaf.tabHeaderEl.parentElement) {
        clearInterval(int);
        console.log(this.leaf.tabHeaderEl.parentElement);
      }
    }, 100);
    container.setAttribute(
      "style",
      import_obsidian.Platform.isMobile ? "padding:0;overflow:hidden;" : "padding:0;padding-bottom:30px;overflow:hidden;"
    );
    container.createEl(
      "iframe",
      {
        cls: "mxmind-iframe",
        attr: {
          style: "width:100%;height:100%;",
          src: getUrl(),
          frameborder: "0"
        }
      },
      (el) => {
        iframe = el;
      }
    );
    container.win.onmessage = (event) => {
      if (event.data.event && event.data.event == "editor-ready") {
        ready = true;
      }
    };
  }
  async onClose() {
  }
};
function waitEditor() {
  return new Promise((resolve, reject) => {
    if (ready) {
      resolve(true);
    } else {
      const t = new Date().getTime();
      const int = setInterval(() => {
        if (ready) {
          clearInterval(int);
          resolve(true);
        } else {
          if (new Date().getTime() - t > 10 * 1e3) {
            clearInterval(int);
            reject(false);
          }
        }
      }, 100);
    }
  });
}
function postIframeMessage(method, params) {
  var _a;
  if (!iframe)
    return;
  (_a = iframe == null ? void 0 : iframe.contentWindow) == null ? void 0 : _a.postMessage(
    {
      method,
      params
    },
    "*"
  );
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtcblx0SXRlbVZpZXcsXG5cdG1vbWVudCxcblx0UGxhdGZvcm0sXG5cdFBsdWdpbixcblx0V29ya3NwYWNlTGVhZixcblx0VEZpbGUsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuXG5sZXQgaWZyYW1lOiBIVE1MSUZyYW1lRWxlbWVudCB8IG51bGwgPSBudWxsO1xubGV0IHJlYWR5ID0gZmFsc2U7XG4vLyBSZW1lbWJlciB0byByZW5hbWUgdGhlc2UgY2xhc3NlcyBhbmQgaW50ZXJmYWNlcyFcbmV4cG9ydCBjb25zdCBWSUVXX1RZUEVfRVhBTVBMRSA9IFwibXhtaW5kLXZpZXdcIjtcbi8vIGludGVyZmFjZSBNeVBsdWdpblNldHRpbmdzIHtcbi8vIFx0bXlTZXR0aW5nOiBzdHJpbmc7XG4vLyB9XG5cbi8vIGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IE15UGx1Z2luU2V0dGluZ3MgPSB7XG4vLyBcdG15U2V0dGluZzogJ2RlZmF1bHQnXG4vLyB9XG5mdW5jdGlvbiBnZXRUaGVtZSgpIHtcblx0cmV0dXJuIGRvY3VtZW50LmJvZHkuaGFzQ2xhc3MoXCJ0aGVtZS1kYXJrXCIpID8gXCJkYXJrXCIgOiBcImxpZ2h0XCI7XG59XG5cbmZ1bmN0aW9uIGdldExhbmd1YWdlKCkge1xuXHRjb25zdCBsb2NhbGUgPSBtb21lbnQubG9jYWxlKCk7XG5cdGNvbnN0IGFyciA9IGxvY2FsZS5zcGxpdChcIi1cIik7XG5cdGlmIChhcnJbMV0pIHtcblx0XHRhcnJbMV0gPSBhcnJbMV0udG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpO1xuXHR9XG5cdHJldHVybiBhcnIuam9pbihcIi1cIik7XG59XG5cbmNvbnN0IGdldFVybCA9ICgpID0+IHtcblx0cmV0dXJuIChcblx0XHRcImh0dHBzOi8vbXhtaW5kLmNvbS9taW5kbWFwL25ldz91dG1fc291cmNlPW9ic2lkaWFuJnRoZW1lPVwiICtcblx0XHRnZXRUaGVtZSgpICtcblx0XHRcIiZsbmc9XCIgK1xuXHRcdGdldExhbmd1YWdlKClcblx0KTtcbn07XG4vLyBjb25zdCByZU9wZW49KCk9Pntcbi8vIFx0cmVhZHk9ZmFsc2U7XG4vLyBcdGlmKGlmcmFtZSlpZnJhbWUuc3JjPWdldFVybCgpKycmXz0nKyhuZXcgRGF0ZSkuZ2V0VGltZSgpO1xuLy8gfVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTXhtaW5kUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0Ly9zZXR0aW5nczogTXlQbHVnaW5TZXR0aW5ncztcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0Ly9hd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXHRcdHRoaXMucmVnaXN0ZXJWaWV3KFxuXHRcdFx0VklFV19UWVBFX0VYQU1QTEUsXG5cdFx0XHQobGVhZikgPT4gbmV3IE14bWluZElmcmFtZVZpZXcobGVhZilcblx0XHQpO1xuXHRcdC8vIFRoaXMgY3JlYXRlcyBhbiBpY29uIGluIHRoZSBsZWZ0IHJpYmJvbi5cblx0XHRjb25zdCByaWJib25JY29uRWwgPSB0aGlzLmFkZFJpYmJvbkljb24oXG5cdFx0XHRcIm5ldHdvcmtcIixcblx0XHRcdFwiTXhtaW5kXCIsXG5cdFx0XHQoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRcdC8vIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyB0aGUgaWNvbi5cblx0XHRcdFx0Ly9uZXcgTm90aWNlKCdUaGlzIGlzIGEgbm90aWNlIScpO1xuXHRcdFx0XHR0aGlzLnRvZ2dsZVZpZXcoKTtcblx0XHRcdH1cblx0XHQpO1xuXHRcdC8vIFBlcmZvcm0gYWRkaXRpb25hbCB0aGluZ3Mgd2l0aCB0aGUgcmliYm9uXG5cdFx0Ly9yaWJib25JY29uRWwuYWRkQ2xhc3MoJ214bWluZCcpO1xuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc3RhdHVzIGJhciBpdGVtIHRvIHRoZSBib3R0b20gb2YgdGhlIGFwcC4gRG9lcyBub3Qgd29yayBvbiBtb2JpbGUgYXBwcy5cblx0XHQvLyBjb25zdCBzdGF0dXNCYXJJdGVtRWwgPSB0aGlzLmFkZFN0YXR1c0Jhckl0ZW0oKTtcblx0XHQvLyBzdGF0dXNCYXJJdGVtRWwuc2V0VGV4dCgnU3RhdHVzIEJhciBUZXh0Jyk7XG5cblx0XHQvLyBUaGlzIGFkZHMgYSBzaW1wbGUgY29tbWFuZCB0aGF0IGNhbiBiZSB0cmlnZ2VyZWQgYW55d2hlcmVcblx0XHQvLyB0aGlzLmFkZENvbW1hbmQoe1xuXHRcdC8vIFx0aWQ6ICdvcGVuLXNhbXBsZS1tb2RhbC1zaW1wbGUnLFxuXHRcdC8vIFx0bmFtZTogJ09wZW4gc2FtcGxlIG1vZGFsIChzaW1wbGUpJyxcblx0XHQvLyBcdGNhbGxiYWNrOiAoKSA9PiB7XG5cdFx0Ly8gXHRcdG5ldyBTYW1wbGVNb2RhbCh0aGlzLmFwcCkub3BlbigpO1xuXHRcdC8vIFx0fVxuXHRcdC8vIH0pO1xuXHRcdC8vIFRoaXMgYWRkcyBhbiBlZGl0b3IgY29tbWFuZCB0aGF0IGNhbiBwZXJmb3JtIHNvbWUgb3BlcmF0aW9uIG9uIHRoZSBjdXJyZW50IGVkaXRvciBpbnN0YW5jZVxuXHRcdC8vIHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0Ly8gXHRpZDogJ3NhbXBsZS1lZGl0b3ItY29tbWFuZCcsXG5cdFx0Ly8gXHRuYW1lOiAnU2FtcGxlIGVkaXRvciBjb21tYW5kJyxcblx0XHQvLyBcdGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdC8vIFx0XHRjb25zb2xlLmxvZyhlZGl0b3IuZ2V0U2VsZWN0aW9uKCkpO1xuXHRcdC8vIFx0XHRlZGl0b3IucmVwbGFjZVNlbGVjdGlvbignU2FtcGxlIEVkaXRvciBDb21tYW5kJyk7XG5cdFx0Ly8gXHR9XG5cdFx0Ly8gfSk7XG5cdFx0Ly8gVGhpcyBhZGRzIGEgY29tcGxleCBjb21tYW5kIHRoYXQgY2FuIGNoZWNrIHdoZXRoZXIgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGFwcCBhbGxvd3MgZXhlY3V0aW9uIG9mIHRoZSBjb21tYW5kXG5cdFx0Ly8gdGhpcy5hZGRDb21tYW5kKHtcblx0XHQvLyBcdGlkOiAnb3Blbi1zYW1wbGUtbW9kYWwtY29tcGxleCcsXG5cdFx0Ly8gXHRuYW1lOiAnT3BlbiBzYW1wbGUgbW9kYWwgKGNvbXBsZXgpJyxcblx0XHQvLyBcdGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuXHRcdC8vIFx0XHQvLyBDb25kaXRpb25zIHRvIGNoZWNrXG5cdFx0Ly8gXHRcdGNvbnN0IG1hcmtkb3duVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG5cdFx0Ly8gXHRcdGlmIChtYXJrZG93blZpZXcpIHtcblx0XHQvLyBcdFx0XHQvLyBJZiBjaGVja2luZyBpcyB0cnVlLCB3ZSdyZSBzaW1wbHkgXCJjaGVja2luZ1wiIGlmIHRoZSBjb21tYW5kIGNhbiBiZSBydW4uXG5cdFx0Ly8gXHRcdFx0Ly8gSWYgY2hlY2tpbmcgaXMgZmFsc2UsIHRoZW4gd2Ugd2FudCB0byBhY3R1YWxseSBwZXJmb3JtIHRoZSBvcGVyYXRpb24uXG5cdFx0Ly8gXHRcdFx0aWYgKCFjaGVja2luZykge1xuXHRcdC8vIFx0XHRcdFx0bmV3IFNhbXBsZU1vZGFsKHRoaXMuYXBwKS5vcGVuKCk7XG5cdFx0Ly8gXHRcdFx0fVxuXG5cdFx0Ly8gXHRcdFx0Ly8gVGhpcyBjb21tYW5kIHdpbGwgb25seSBzaG93IHVwIGluIENvbW1hbmQgUGFsZXR0ZSB3aGVuIHRoZSBjaGVjayBmdW5jdGlvbiByZXR1cm5zIHRydWVcblx0XHQvLyBcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHQvLyBcdFx0fVxuXHRcdC8vIFx0fVxuXHRcdC8vIH0pO1xuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc2V0dGluZ3MgdGFiIHNvIHRoZSB1c2VyIGNhbiBjb25maWd1cmUgdmFyaW91cyBhc3BlY3RzIG9mIHRoZSBwbHVnaW5cblx0XHQvL3RoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2FtcGxlU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG5cdFx0Ly8gSWYgdGhlIHBsdWdpbiBob29rcyB1cCBhbnkgZ2xvYmFsIERPTSBldmVudHMgKG9uIHBhcnRzIG9mIHRoZSBhcHAgdGhhdCBkb2Vzbid0IGJlbG9uZyB0byB0aGlzIHBsdWdpbilcblx0XHQvLyBVc2luZyB0aGlzIGZ1bmN0aW9uIHdpbGwgYXV0b21hdGljYWxseSByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVyIHdoZW4gdGhpcyBwbHVnaW4gaXMgZGlzYWJsZWQuXG5cdFx0Ly8gdGhpcy5yZWdpc3RlckRvbUV2ZW50KGRvY3VtZW50LCAnY2xpY2snLCAoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0Ly8gXHRjb25zb2xlLmxvZygnY2xpY2snLCBldnQpO1xuXHRcdC8vIH0pO1xuXG5cdFx0Ly8gV2hlbiByZWdpc3RlcmluZyBpbnRlcnZhbHMsIHRoaXMgZnVuY3Rpb24gd2lsbCBhdXRvbWF0aWNhbGx5IGNsZWFyIHRoZSBpbnRlcnZhbCB3aGVuIHRoZSBwbHVnaW4gaXMgZGlzYWJsZWQuXG5cblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnQoXG5cdFx0XHR0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJmaWxlLW1lbnVcIiwgKG1lbnUsIGZpbGUpID0+IHtcblx0XHRcdFx0Ly9AdHMtaWdub3JlXG5cdFx0XHRcdGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uIGFzIHN0cmluZztcblx0XHRcdFx0aWYgKCFleHRlbnNpb24gfHwgZXh0ZW5zaW9uICE9IFwibWRcIikgcmV0dXJuO1xuXHRcdFx0XHRpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSByZXR1cm47XG5cdFx0XHRcdC8vY29uc3Qge3ZhdWx0fSA9IHRoaXMuYXBwO1xuXHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRpdGVtLnNldFRpdGxlKFwiT3BlbiBhcyBtaW5kbWFwXCIpXG5cdFx0XHRcdFx0XHQuc2V0SWNvbihcImRvY3VtZW50XCIpXG5cdFx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdC8vY29uc3QgbGVhZiA9IGF3YWl0IHRoaXMuYWN0aXZhdGVWaWV3KCk7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jYWNoZWRSZWFkKFxuXHRcdFx0XHRcdFx0XHRcdGZpbGVcblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdFx0Ly9jb25zb2xlLmxvZyhjb250ZW50KVxuXHRcdFx0XHRcdFx0XHRjb25zdCBwb3N0ID0gYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHBvc3RJZnJhbWVNZXNzYWdlKFwibG9hZEZyb21NZFwiLCBbY29udGVudF0pO1xuXHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRhd2FpdCB0aGlzLmFjdGl2YXRlVmlldygpO1xuXHRcdFx0XHRcdFx0XHR3YWl0RWRpdG9yKCkudGhlbihwb3N0KS5jYXRjaChwb3N0KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pXG5cdFx0KTtcblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnQoXG5cdFx0XHR0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJjc3MtY2hhbmdlXCIsICgpID0+IHtcblx0XHRcdFx0cG9zdElmcmFtZU1lc3NhZ2UoXCJzZXRUaGVtZVwiLCBbZ2V0VGhlbWUoKV0pO1xuXHRcdFx0fSlcblx0XHQpO1xuXHR9XG5cblx0b251bmxvYWQoKSB7fVxuXG5cdC8vIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0Ly8gXHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblx0Ly8gfVxuXG5cdC8vIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcblx0Ly8gXHRhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuXHQvLyB9XG5cdGFzeW5jIHRvZ2dsZVZpZXcoKSB7XG5cdFx0Y29uc3QgeyB3b3Jrc3BhY2UgfSA9IHRoaXMuYXBwO1xuXHRcdHRoaXMudG9nZ2xlQ29sbGFwc2VSaWdodCgpO1xuXHRcdGxldCBsZWFmOiBXb3Jrc3BhY2VMZWFmIHwgbnVsbCA9IG51bGw7XG5cdFx0Y29uc3QgbGVhdmVzID0gd29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEVfRVhBTVBMRSk7XG5cblx0XHRpZiAobGVhdmVzLmxlbmd0aCA+IDApIHtcblx0XHRcdC8vIEEgbGVhZiB3aXRoIG91ciB2aWV3IGFscmVhZHkgZXhpc3RzLCB1c2UgdGhhdFxuXHRcdFx0bGVhZiA9IGxlYXZlc1swXTtcblxuXHRcdFx0d29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIE91ciB2aWV3IGNvdWxkIG5vdCBiZSBmb3VuZCBpbiB0aGUgd29ya3NwYWNlLCBjcmVhdGUgYSBuZXcgbGVhZlxuXHRcdFx0Ly8gaW4gdGhlIHJpZ2h0IHNpZGViYXIgZm9yIGl0XG5cdFx0XHRsZWFmID0gd29ya3NwYWNlLmdldFJpZ2h0TGVhZihmYWxzZSk7XG5cdFx0XHRhd2FpdCBsZWFmLnNldFZpZXdTdGF0ZSh7IHR5cGU6IFZJRVdfVFlQRV9FWEFNUExFLCBhY3RpdmU6IHRydWUgfSk7XG5cdFx0fVxuXG5cdFx0aWZyYW1lPy5jb250ZW50V2luZG93Py5wb3N0TWVzc2FnZShcblx0XHRcdHtcblx0XHRcdFx0bWV0aG9kOiBcImZ1bGxTY3JlZW5cIixcblx0XHRcdFx0cGFyYW1zOiBbXSxcblx0XHRcdH0sXG5cdFx0XHRcIipcIlxuXHRcdCk7XG5cblx0XHQvLyBcIlJldmVhbFwiIHRoZSBsZWFmIGluIGNhc2UgaXQgaXMgaW4gYSBjb2xsYXBzZWQgc2lkZWJhclxuXHRcdC8vd29ya3NwYWNlLnJldmVhbExlYWYobGVhZik7XG5cdH1cblxuXHRhc3luYyBhY3RpdmF0ZVZpZXcoKSB7XG5cdFx0Y29uc3QgeyB3b3Jrc3BhY2UgfSA9IHRoaXMuYXBwO1xuXG5cdFx0bGV0IGxlYWY6IFdvcmtzcGFjZUxlYWYgfCBudWxsID0gbnVsbDtcblx0XHRjb25zdCBsZWF2ZXMgPSB3b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKFZJRVdfVFlQRV9FWEFNUExFKTtcblxuXHRcdGlmIChsZWF2ZXMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gQSBsZWFmIHdpdGggb3VyIHZpZXcgYWxyZWFkeSBleGlzdHMsIHVzZSB0aGF0XG5cdFx0XHRsZWFmID0gbGVhdmVzWzBdO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBPdXIgdmlldyBjb3VsZCBub3QgYmUgZm91bmQgaW4gdGhlIHdvcmtzcGFjZSwgY3JlYXRlIGEgbmV3IGxlYWZcblx0XHRcdC8vIGluIHRoZSByaWdodCBzaWRlYmFyIGZvciBpdFxuXHRcdFx0bGVhZiA9IHdvcmtzcGFjZS5nZXRSaWdodExlYWYoZmFsc2UpO1xuXHRcdH1cblx0XHRhd2FpdCBsZWFmLnNldFZpZXdTdGF0ZSh7IHR5cGU6IFZJRVdfVFlQRV9FWEFNUExFLCBhY3RpdmU6IHRydWUgfSk7XG5cdFx0Ly8gXCJSZXZlYWxcIiB0aGUgbGVhZiBpbiBjYXNlIGl0IGlzIGluIGEgY29sbGFwc2VkIHNpZGViYXJcblx0XHR3b3Jrc3BhY2UucmV2ZWFsTGVhZihsZWFmKTtcblx0XHRyZXR1cm4gbGVhZjtcblx0fVxuXG5cdHRvZ2dsZUNvbGxhcHNlUmlnaHQoKSB7XG5cdFx0Y29uc3QgcmlnaHRTcGxpdCA9IHRoaXMuYXBwLndvcmtzcGFjZS5yaWdodFNwbGl0O1xuXG5cdFx0cmlnaHRTcGxpdC5jb2xsYXBzZWQgPyByaWdodFNwbGl0LmV4cGFuZCgpIDogcmlnaHRTcGxpdC5jb2xsYXBzZSgpO1xuXHR9XG59XG5cbmV4cG9ydCBjbGFzcyBNeG1pbmRJZnJhbWVWaWV3IGV4dGVuZHMgSXRlbVZpZXcge1xuXHRuYXZpZ2F0aW9uID0gdHJ1ZTtcblxuXHRjb25zdHJ1Y3RvcihsZWFmOiBXb3Jrc3BhY2VMZWFmKSB7XG5cdFx0c3VwZXIobGVhZik7XG5cdH1cblxuXHRnZXRWaWV3VHlwZSgpIHtcblx0XHRyZXR1cm4gVklFV19UWVBFX0VYQU1QTEU7XG5cdH1cblxuXHRnZXREaXNwbGF5VGV4dCgpIHtcblx0XHRyZXR1cm4gXCJNeG1pbmRcIjtcblx0fVxuXHRnZXRJY29uKCkge1xuXHRcdHJldHVybiBcIm5ldHdvcmtcIjtcblx0fVxuXG5cdGFzeW5jIG9uT3BlbigpIHtcblx0XHRjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lckVsLmNoaWxkcmVuWzFdO1xuXHRcdGNvbnRhaW5lci5lbXB0eSgpO1xuXHRcdGNvbnN0IGludCA9IHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdC8vQHRzLWlnbm9yZVxuXHRcdFx0aWYgKHRoaXMubGVhZi50YWJIZWFkZXJFbCAmJiB0aGlzLmxlYWYudGFiSGVhZGVyRWwucGFyZW50RWxlbWVudCkge1xuXHRcdFx0XHRjbGVhckludGVydmFsKGludCk7XG5cdFx0XHRcdC8vQHRzLWlnbm9yZVxuXHRcdFx0XHRjb25zb2xlLmxvZyh0aGlzLmxlYWYudGFiSGVhZGVyRWwucGFyZW50RWxlbWVudCk7XG5cdFx0XHRcdC8vdGhpcy5sZWFmLnRhYkhlYWRlckVsLnBhcmVudEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHRcdFx0fVxuXHRcdH0sIDEwMCk7XG5cdFx0Y29udGFpbmVyLnNldEF0dHJpYnV0ZShcblx0XHRcdFwic3R5bGVcIixcblx0XHRcdFBsYXRmb3JtLmlzTW9iaWxlXG5cdFx0XHRcdD8gXCJwYWRkaW5nOjA7b3ZlcmZsb3c6aGlkZGVuO1wiXG5cdFx0XHRcdDogXCJwYWRkaW5nOjA7cGFkZGluZy1ib3R0b206MzBweDtvdmVyZmxvdzpoaWRkZW47XCJcblx0XHQpO1xuXG5cdFx0Y29udGFpbmVyLmNyZWF0ZUVsKFxuXHRcdFx0XCJpZnJhbWVcIixcblx0XHRcdHtcblx0XHRcdFx0Y2xzOiBcIm14bWluZC1pZnJhbWVcIixcblx0XHRcdFx0YXR0cjoge1xuXHRcdFx0XHRcdHN0eWxlOiBcIndpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7XCIsXG5cdFx0XHRcdFx0c3JjOiBnZXRVcmwoKSxcblx0XHRcdFx0XHRmcmFtZWJvcmRlcjogXCIwXCIsXG5cdFx0XHRcdH0sXG5cdFx0XHR9LFxuXHRcdFx0KGVsKSA9PiB7XG5cdFx0XHRcdGlmcmFtZSA9IGVsO1xuXHRcdFx0fVxuXHRcdCk7XG5cdFx0Y29udGFpbmVyLndpbi5vbm1lc3NhZ2UgPSAoZXZlbnQ6IE1lc3NhZ2VFdmVudCkgPT4ge1xuXHRcdFx0aWYgKGV2ZW50LmRhdGEuZXZlbnQgJiYgZXZlbnQuZGF0YS5ldmVudCA9PSBcImVkaXRvci1yZWFkeVwiKSB7XG5cdFx0XHRcdHJlYWR5ID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9O1xuXHR9XG5cblx0YXN5bmMgb25DbG9zZSgpIHtcblx0XHQvLyBOb3RoaW5nIHRvIGNsZWFuIHVwLlxuXHR9XG59XG5cbmZ1bmN0aW9uIHdhaXRFZGl0b3IoKSB7XG5cdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0aWYgKHJlYWR5KSB7XG5cdFx0XHRyZXNvbHZlKHRydWUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCB0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBpbnQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0XHRcdGlmIChyZWFkeSkge1xuXHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoaW50KTtcblx0XHRcdFx0XHRyZXNvbHZlKHRydWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHQgPiAxMCAqIDEwMDApIHtcblx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoaW50KTtcblx0XHRcdFx0XHRcdHJlamVjdChmYWxzZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LCAxMDApO1xuXHRcdH1cblx0fSk7XG59XG5cbmZ1bmN0aW9uIHBvc3RJZnJhbWVNZXNzYWdlKG1ldGhvZDogc3RyaW5nLCBwYXJhbXM6IEFycmF5PGFueT4pIHtcblx0aWYgKCFpZnJhbWUpIHJldHVybjtcblx0aWZyYW1lPy5jb250ZW50V2luZG93Py5wb3N0TWVzc2FnZShcblx0XHR7XG5cdFx0XHRtZXRob2QsXG5cdFx0XHRwYXJhbXMsXG5cdFx0fSxcblx0XHRcIipcIlxuXHQpO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFPTztBQUVQLElBQUksU0FBbUM7QUFDdkMsSUFBSSxRQUFRO0FBRUwsSUFBTSxvQkFBb0I7QUFRakMsU0FBUyxXQUFXO0FBQ25CLFNBQU8sU0FBUyxLQUFLLFNBQVMsWUFBWSxJQUFJLFNBQVM7QUFDeEQ7QUFFQSxTQUFTLGNBQWM7QUFDdEIsUUFBTSxTQUFTLHVCQUFPLE9BQU87QUFDN0IsUUFBTSxNQUFNLE9BQU8sTUFBTSxHQUFHO0FBQzVCLE1BQUksSUFBSSxDQUFDLEdBQUc7QUFDWCxRQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsRUFBRSxTQUFTLEVBQUUsWUFBWTtBQUFBLEVBQ3hDO0FBQ0EsU0FBTyxJQUFJLEtBQUssR0FBRztBQUNwQjtBQUVBLElBQU0sU0FBUyxNQUFNO0FBQ3BCLFNBQ0MsOERBQ0EsU0FBUyxJQUNULFVBQ0EsWUFBWTtBQUVkO0FBS0EsSUFBcUIsZUFBckIsY0FBMEMsdUJBQU87QUFBQTtBQUFBLEVBR2hELE1BQU0sU0FBUztBQUVkLFNBQUs7QUFBQSxNQUNKO0FBQUEsTUFDQSxDQUFDLFNBQVMsSUFBSSxpQkFBaUIsSUFBSTtBQUFBLElBQ3BDO0FBRUEsVUFBTSxlQUFlLEtBQUs7QUFBQSxNQUN6QjtBQUFBLE1BQ0E7QUFBQSxNQUNBLENBQUMsUUFBb0I7QUFHcEIsYUFBSyxXQUFXO0FBQUEsTUFDakI7QUFBQSxJQUNEO0FBd0RBLFNBQUs7QUFBQSxNQUNKLEtBQUssSUFBSSxVQUFVLEdB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
